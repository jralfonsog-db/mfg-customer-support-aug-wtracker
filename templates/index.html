<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Transcript Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
</head>
<body>
    <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#eeeeec] px-10 py-3">
        <div class="flex items-center gap-4 text-[#151513]">
            <a data-external-link="true" href="https://dbricks.co/manufacturing" target="_blank" class="flex items-center" aria-label="Header databricks logo"><figure class="h-full w-full"><div class="h-full "><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTMyIiBoZWlnaHQ9IjIyIiB2aWV3Qm94PSIwIDAgMTMyIDIyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0xOC4zMTggOS4yNzUtOC42MzEgNC44NTlMLjQ0NSA4Ljk0MiAwIDkuMTgydjMuNzdsOS42ODcgNS40MzEgOC42My00Ljg0djEuOTk1bC04LjYzIDQuODYtOS4yNDItNS4xOTItLjQ0NS4yNHYuNjQ2bDkuNjg3IDUuNDMyIDkuNjY4LTUuNDMydi0zLjc2OWwtLjQ0NS0uMjQtOS4yMjMgNS4xNzMtOC42NS00Ljg0VjEwLjQybDguNjUgNC44NCA5LjY2OC01LjQzVjYuMTE0bC0uNDgyLS4yNzctOS4xODYgNS4xNTVMMS40ODIgNi40MWw4LjIwNS00LjYgNi43NDEgMy43ODcuNTkzLS4zMzJ2LS40NjJMOS42ODcuNjg0IDAgNi4xMTV2LjU5Mmw5LjY4NyA1LjQzMiA4LjYzLTQuODZ6IiBmaWxsPSIjRUUzRDJDIi8+PHBhdGggZD0iTTM3LjQ0OSAxOC40NDNWMS44NTJoLTIuNTU2djYuMjA3YzAgLjA5My0uMDU2LjE2Ny0uMTQ4LjIwNGEuMjMuMjMgMCAwIDEtLjI0LS4wNTZjLS44NzEtMS4wMTYtMi4yMjMtMS41ODktMy43MDUtMS41ODktMy4xNjcgMC01LjY1IDIuNjYtNS42NSA2LjA2IDAgMS42NjMuNTc1IDMuMTk3IDEuNjMgNC4zMjRhNS40NCA1LjQ0IDAgMCAwIDQuMDIgMS43MzZjMS40NjMgMCAyLjgxNS0uNjEgMy43MDQtMS42NjIuMDU2LS4wNzQuMTY3LS4wOTMuMjQtLjA3NC4wOTMuMDM3LjE1LjExLjE1LjIwM3YxLjIzOHptLTYuMDkzLTIuMDE0Yy0yLjAzOCAwLTMuNjMtMS42NDQtMy42My0zLjc1IDAtMi4xMDcgMS41OTItMy43NTEgMy42My0zLjc1MXMzLjYzIDEuNjQ0IDMuNjMgMy43NS0xLjU5MyAzLjc1LTMuNjMgMy43NW0xOS43NjIgMi4wMTZWNi44OTZoLTIuNTM3VjguMDZjMCAuMDkzLS4wNTYuMTY2LS4xNDkuMjAzYS4yLjIgMCAwIDEtLjI0LS4wNzNjLS44NTItMS4wMTctMi4xODYtMS41OS0zLjcwNS0xLjU5LTMuMTY3IDAtNS42NDkgMi42NjEtNS42NDkgNi4wNiAwIDMuNCAyLjQ4MiA2LjA2IDUuNjUgNi4wNiAxLjQ2MyAwIDIuODE1LS42MSAzLjcwNC0xLjY4LjA1NS0uMDc1LjE2Ni0uMDkzLjI0LS4wNzUuMDkzLjAzNy4xNDkuMTExLjE0OS4yMDR2MS4yNTZoMi41Mzd6bS02LjA1Ni0yLjAxNGMtMi4wMzggMC0zLjYzLTEuNjQ1LTMuNjMtMy43NSAwLTIuMTA3IDEuNTkyLTMuNzUxIDMuNjMtMy43NTFzMy42MyAxLjY0NCAzLjYzIDMuNzUtMS41OTMgMy43NS0zLjYzIDMuNzVtMjcuNzgxIDIuMDE1VjYuODk2aC0yLjUzOFY4LjA2YzAgLjA5My0uMDU1LjE2Ni0uMTQ4LjIwM3MtLjE4NSAwLS4yNC0uMDczYy0uODUzLTEuMDE3LTIuMTg2LTEuNTktMy43MDUtMS41OS0zLjE4NiAwLTUuNjQ5IDIuNjYxLTUuNjQ5IDYuMDggMCAzLjQxNyAyLjQ4MiA2LjA2IDUuNjQ5IDYuMDYgMS40NjMgMCAyLjgxNS0uNjEgMy43MDQtMS42ODIuMDU2LS4wNzQuMTY3LS4wOTMuMjQxLS4wNzQuMDkzLjAzNy4xNDguMTEuMTQ4LjIwM3YxLjI1NnptLTYuMDU3LTIuMDE0Yy0yLjAzNyAwLTMuNjMtMS42NDUtMy42My0zLjc1IDAtMi4xMDcgMS41OTMtMy43NTEgMy42My0zLjc1MXMzLjYzIDEuNjQ0IDMuNjMgMy43NS0xLjU5MyAzLjc1LTMuNjMgMy43NW0xMC43MDYuNjQ3Yy4wMTkgMCAuMDU2LS4wMTkuMDc0LS4wMTkuMDU2IDAgLjEzLjAzNy4xNjcuMDc0Ljg3IDEuMDE2IDIuMjIyIDEuNTg5IDMuNzA0IDEuNTg5IDMuMTY3IDAgNS42NS0yLjY2IDUuNjUtNi4wNiAwLTEuNjYzLS41NzUtMy4xOTYtMS42My00LjMyM2E1LjQ0IDUuNDQgMCAwIDAtNC4wMi0xLjczN2MtMS40NjMgMC0yLjgxNS42MS0zLjcwNCAxLjY2My0uMDU2LjA3NC0uMTQ4LjA5Mi0uMjQuMDc0LS4wOTMtLjAzNy0uMTQ5LS4xMTEtLjE0OS0uMjA0VjEuODUyaC0yLjU1NnYxNi41OWgyLjU1NlYxNy4yOGMwLS4wOTMuMDU2LS4xNjYuMTQ4LS4yMDNtLS4yNi00LjM5OGMwLTIuMTA2IDEuNTk0LTMuNzUgMy42MzEtMy43NXMzLjYzIDEuNjQ0IDMuNjMgMy43NS0xLjU5MyAzLjc1LTMuNjMgMy43NS0zLjYzLTEuNjYyLTMuNjMtMy43NW0xNy4yNDQtMy40MTZjLjI0IDAgLjQ2My4wMTkuNjEuMDU2VjYuNjk1YTIuNCAyLjQgMCAwIDAtLjQyNS0uMDM3Yy0xLjMzNCAwLTIuNTU2LjY4NC0zLjIwNCAxLjc3NC0uMDU2LjA5Mi0uMTQ5LjEzLS4yNDEuMDkyYS4yMi4yMiAwIDAgMS0uMTY3LS4yMDNWNi44OThoLTIuNTM3djExLjU2NmgyLjU1NnYtNS4xYzAtMi41MyAxLjI5Ni00LjEgMy40MDgtNC4xbTQuODE1LTIuMzY3aC0yLjU5M3YxMS41NjZoMi41OTN6TTk3Ljk1OCAxLjg3YTEuNTcxIDEuNTcxIDAgMSAwIDAgMy4xNDEgMS41NzEgMS41NzEgMCAxIDAgMC0zLjE0bTguOTI4IDQuNzI5Yy0zLjU1NiAwLTYuMTMxIDIuNTUtNi4xMzEgNi4wOCAwIDEuNzE3LjYxMiAzLjI1IDEuNzA0IDQuMzYgMS4xMTIgMS4xMDggMi42NjcgMS43MTggNC40MDggMS43MTggMS40NDUgMCAyLjU1Ni0uMjc3IDQuNjY4LTEuODNsLTEuNDYzLTEuNTMzYy0xLjAzOC42ODQtMi4wMDEgMS4wMTYtMi45NDUgMS4wMTYtMi4xNDkgMC0zLjc2LTEuNjA3LTMuNzYtMy43MzJzMS42MTEtMy43MzIgMy43Ni0zLjczMmMxLjAxOCAwIDEuOTYzLjMzMyAyLjkwOCAxLjAxNmwxLjYyOS0xLjUzM2MtMS45MDctMS42MjYtMy42My0xLjgzLTQuNzc4LTEuODNtOS4xNDkgNi43NjJhLjIuMiAwIDAgMSAuMTQ5LS4wNTVoLjAxOGMuMDU2IDAgLjExMS4wMzcuMTY3LjA3M2w0LjA5MyA1LjA2M2gzLjE0OWwtNS4yOTctNi4zOTNjLS4wNzUtLjA5Mi0uMDc1LS4yMjIuMDE4LS4yOTVsNC44NzEtNC44NmgtMy4xM2wtNC4yMDQgNC4yMTNjLS4wNTYuMDU1LS4xNDguMDc0LS4yNDEuMDU1YS4yMy4yMyAwIDAgMS0uMTMtLjIwM1YxLjg3aC0yLjU3NHYxNi41OTFoMi41NTZ2LTQuNTA4YzAtLjA1NS4wMTgtLjEzLjA3NC0uMTY2eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik0xMjcuNzc2IDE4LjczOWMyLjA5MyAwIDQuMjIzLTEuMjc1IDQuMjIzLTMuNjk1IDAtMS41ODktMS0yLjY4LTMuMDM3LTMuMzQ0bC0xLjM5LS40NjJjLS45NDQtLjMxNC0xLjM4OS0uNzU4LTEuMzg5LTEuMzY3IDAtLjcwMi42My0xLjE4MyAxLjUxOS0xLjE4My44NTIgMCAxLjYxMS41NTUgMi4wOTMgMS41MTVsMi4wNTYtMS4xMDhjLS43NTktMS41NTItMi4zMzQtMi41MTMtNC4xNDktMi41MTMtMi4yOTcgMC0zLjk2MyAxLjQ3OC0zLjk2MyAzLjQ5MiAwIDEuNjA3Ljk2MyAyLjY3OSAyLjk0NCAzLjMwN2wxLjQyNy40NjJjMSAuMzE0IDEuNDI2LjcyIDEuNDI2IDEuMzY3IDAgLjk4LS45MDggMS4zMy0xLjY4NiAxLjMzLTEuMDM3IDAtMS45NjMtLjY2NS0yLjQwNy0xLjc1NWwtMi4wOTMgMS4xMDljLjY4NSAxLjc1NSAyLjM3IDIuODQ1IDQuNDI2IDIuODQ1bS02OS41NDYtLjExMWMuODE1IDAgMS41MzgtLjA3NCAxLjk0NS0uMTN2LTIuMjE2YTE0IDE0IDAgMCAxLTEuMjc4LjA3M2MtMS4wMzcgMC0xLjgzMy0uMTg0LTEuODMzLTIuNDJWOS4xODdjMC0uMTMuMDkyLS4yMjIuMjIyLS4yMjJoMi41VjYuODc3aC0yLjVhLjIxNC4yMTQgMCAwIDEtLjIyMi0uMjIxVjMuMzNoLTIuNTU2djMuMzQ0YzAgLjEzLS4wOTMuMjIyLS4yMjMuMjIyaC0xLjc3OHYyLjA4OGgxLjc3OGMuMTMgMCAuMjIzLjA5Mi4yMjMuMjIxdjUuMzc3YzAgNC4wNDYgMi43MDQgNC4wNDYgMy43MjIgNC4wNDYiIGZpbGw9IiMwMDAiLz48L3N2Zz4=" alt="" loading="lazy" data-ot-ignore="1" class="max-h-full h-full object-contain object-center optanon-category-C0001"></div></figure></a>
            <h2 class="text-[#151513] text-xl leading-tight">Manufacturing</h2>
        </div>
        <div class="flex flex-1 justify-end gap-8">
            <div class="flex items-center gap-9">
                <a class="text-[#151513] text-lg leading-normal" href="#">Dashboard</a>
            </div>
            <div
                class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                style='background-image: url("/static/assets/unsplash_photos_a-man-wearing-glasses-and-a-black-shirt-iEEBWgY_6lA.jpeg");'
            ></div>
        </div>
    </header>

    <div class="container">
        <!-- Column 1: Input -->
        <div class="column">
            <h2>Transcript Input</h2>
            <form id="transcript-form" action="javascript:void(0);" method="post">
                <div class="form-group">
                    <label for="mlflow_experiment_id">MLflow Experiment ID:</label>
                    <input type="text" id="mlflow_experiment_id" name="mlflow_experiment_id" 
                           value="3790321342839061"
                           placeholder="Enter MLflow experiment ID">
                </div>

                <div class="form-group">
                    <label for="llm_model">Databricks LLM Model:</label>
                    <select id="llm_model" name="llm_model">
                        <option value="databricks-gpt-oss-20b"
                                {% if session.get('llm_model', 'databricks-claude-3-7-sonnet') == 'databricks-gpt-oss-20b' %}selected{% endif %}>
                            databricks-gpt-oss-20b
                        </option>
                        <option value="databricks-gpt-oss-120b"
                                {% if session.get('llm_model', 'databricks-claude-3-7-sonnet') == 'databricks-gpt-oss-120b' %}selected{% endif %}>
                            databricks-gpt-oss-120b
                        </option>
                        <option value="databricks-llama-4-maverick" 
                                {% if session.get('llm_model', 'databricks-claude-3-7-sonnet') == 'databricks-llama-4-maverick' %}selected{% endif %}>
                            databricks-llama-4-maverick
                        </option>
                        <option value="databricks-claude-3-7-sonnet" 
                                {% if session.get('llm_model', 'databricks-claude-3-7-sonnet') == 'databricks-claude-3-7-sonnet' %}selected{% endif %}>
                            databricks-claude-3-7-sonnet
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="transcript">Enter your transcript here:</label>
                    <div class="transcript-container">
                        <textarea id="transcript" name="transcript" rows="15" required>{{ transcript_input }}</textarea>
                        <button type="button" id="mic-button" class="mic-button" title="Record Audio">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    <div id="recording-status" class="recording-status" style="display: none;">Recording... <span id="recording-time">0:00</span></div>
                    <button type="button" id="demo-mode-button" class="secondary-button">Demo Mode</button>
                    <div id="demo-buttons-container" style="display: none; margin-top: 10px;"
                         data-demo-state="{{ demo_state|tojson }}">
                        <button type="button" id="turn1-button" class="secondary-button" data-turn="1" 
                                {% if demo_state.turn1_processed %}disabled{% endif %}>
                            Turn 1
                        </button>
                        <button type="button" id="turn2-button" class="secondary-button" data-turn="2"
                                {% if demo_state.turn2_processed %}disabled{% endif %}>
                            Turn 2
                        </button>
                        <button type="button" id="turn3-button" class="secondary-button" data-turn="3"
                                {% if demo_state.turn3_processed %}disabled{% endif %}>
                            Turn 3
                        </button>
                        <button type="button" id="full-transcript-button" class="secondary-button">Full Transcript</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="call_agent_ask">Call agent's specific question (optional):</label>
                    <input type="text" id="call_agent_ask" name="call_agent_ask">
                </div>

                <button type="submit" id="process-button" class="secondary-button" {% if processing %}disabled{% endif %}>Process Transcript</button>

                {% if processing %}
                <div class="info-box">ðŸ”„ Processing transcript...</div>
                {% endif %}

                <!-- Hidden input to ensure form submission works even if JavaScript is disabled -->
                <input type="hidden" name="submit_type" value="process_transcript">
            </form>
        </div>

        <!-- Column 2: AI Response -->
        <div class="column">
            <h2>AI Assistant Response</h2>

            {% if processing %}
            <div id="processing-indicator" class="spinner"></div>
            {% endif %}

            <div id="ai-response-container">
                {% if ai_response %}
                {{ ai_response|safe }}
                {% else %}
                <div class="info-box">No response yet. Submit a transcript to see the AI assistant's response here.</div>
                {% endif %}
            </div>
        </div>

        <!-- Column 3: History -->
        <div class="column">
            <h2>Transcript History</h2>

            {% if conversation_history %}
            <button id="clear-history-button" class="secondary-button">Clear History</button>

            {% for entry in conversation_history|reverse %}
            <div class="conversation">
                <div class="conversation-header">Conversation {{ loop.revindex }}</div>
                <div class="conversation-body" {% if loop.first %}style="display: block"{% else %}style="display: none"{% endif %}>
                    <div class="conversation-section">
                        <h3>User Transcript</h3>
                        <textarea disabled rows="8">{{ entry.transcript }}</textarea>
                    </div>

                    <div class="conversation-section">
                        <h3>AI Response</h3>
                        <div>{{ entry.response|safe }}</div>
                    </div>

                    {% if entry.queried_table %}
                    <div class="conversation-section">
                        <h3>Queried Table</h3>
                        <pre>{{ entry.queried_table }}</pre>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            {% else %}
            <div class="info-box">No conversation history yet. Submit a transcript to see the history here.</div>
            {% endif %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
